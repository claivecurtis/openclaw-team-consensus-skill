#!/usr/bin/env python3\n\nimport json\nimport os\nimport sys\nimport datetime\nimport re\nimport shutil\n\n# Update Team skill config and changelog\n\nconfig_path = os.path.join(os.path.dirname(__file__), 'config.json')\nskill_path = os.path.join(os.path.dirname(__file__), 'SKILL.md')\n\nconfig = {\n    \"num_reviewers\": 3,\n    \"enable_discussion\": True,\n    \"voting_threshold\": 0.7,\n    \"max_reviewers\": 5,\n    \"timeout_minutes\": 10,\n    \"max_iterations\": 1,\n    \"status_update_interval_minutes\": 5,\n    \"composition\": {\"code-agent\": 3}\n}\n\n# Check if config exists and preserve user changes if present\nif os.path.exists(config_path):\n    backup_path = config_path + '.bak'\n    shutil.copy2(config_path, backup_path)\n    print(f\"Backup created: {backup_path}\")\n    try:\n        with open(config_path, 'r') as f:\n            existing_config = json.load(f)\n        # Merge existing with defaults, preferring existing\n        config.update(existing_config)\n        print(\"Existing config preserved and updated with new defaults.\")\n    except json.JSONDecodeError:\n        print(\"Warning: Existing config.json invalid. Using backup and defaults.\")\n    except Exception as e:\n        print(f\"Warning: Error reading config.json: {e}. Using backup and defaults.\")\n\n# Write the config\nwith open(config_path, 'w') as f:\n    json.dump(config, f, indent=2)\n\nprint(\"Team skill updated successfully. Config saved to config.json.\")\n\n# Update SKILL.md changelog\nwith open(skill_path, 'r') as f:\n    content = f.read()\n\n# Find last version\nversion_pattern = r'### Version (\\d+(?:\\.\\d+)*) \\(\\d{{4}}-\\d{{2}}-\\d{{2}}\\)'\nmatches = re.findall(version_pattern, content)\ndef parse_version(v):\n    parts = [int(p) for p in re.split(r'\\.', v) if p] + [0, 0]\n    return tuple(parts[:3])\nif matches:\n    last_version_str = max(matches, key=parse_version)\n    parts = [int(p) for p in re.split(r'\\.', last_version_str) if p] + [0, 0]\n    major, minor, patch = parts[:3]\n    if patch < 9:\n        new_version = f\"{major}.{minor}.{patch + 1}\"\n    else:\n        new_version = f\"{major}.{minor + 1}.0\"\nelse:\n    new_version = \"1.0.0\"\n\n# Current date\ntoday = datetime.date.today().isoformat()\n\n# Summary\nif len(sys.argv) > 1:\n    summary = ' '.join(sys.argv[1:])\nelse:\n    summary = \"Auto skill update\"\n\n# New entry\nnew_entry = f\"\\n### Version {new_version} ({today})\\n- {summary}\\n\"\n\n# Find position to insert: before ## Files\nfiles_pos = content.find('## Files')\nif files_pos != -1:\n    content = content[:files_pos] + new_entry + content[files_pos:]\nelse:\n    content += new_entry\n\n# Write back\nwith open(skill_path, 'w') as f:\n    f.write(content)\n\nprint(f\"Updated SKILL.md to version {new_version} with summary: {summary}\")